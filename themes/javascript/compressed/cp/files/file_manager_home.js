/*!
 * ExpressionEngine - by EllisLab
 *
 * @package		ExpressionEngine
 * @author		EllisLab Dev Team
 * @copyright	Copyright (c) 2003 - 2014, EllisLab, Inc.
 * @license		http://ellislab.com/expressionengine/user-guide/license.html
 * @link		http://ellislab.com
 * @since		Version 2.0
 * @filesource
 */
$.ee_filemanager=$.filemanager||{},$(document).ready(function(){$.ee_filemanager.file_uploader(),$.ee_filemanager.datatables(),$.ee_filemanager.image_overlay(),$.ee_filemanager.date_range(),$.ee_filemanager.toggle_all(),$.ee_filemanager.directory_change(),$(".paginationLinks .first").hide(),$(".paginationLinks .previous").hide()}),$.ee_filemanager.file_uploader=function(){$.ee_fileuploader({type:"filemanager",load:function(){$.template("filemanager_row",$("#filemanager_row").remove())},open:function(){$.ee_fileuploader.set_directory_id($("#dir_id").val())},after_upload:function(e,t){if(1==t.replace&&$(".mainTable tbody tr:has(td:contains("+t.file_id+")):has(td:contains("+t.file_name+"))").remove(),t.actions="",$.each(EE.fileuploader.actions,function(e,a){var n=a.replace("[file_id]",t.file_id).replace("[upload_dir]",t.upload_directory_prefs.id);"delete"==e?t.action_delete=n:("image"!=e||t.is_image)&&(t.actions+=n+"&nbsp;&nbsp;")}),"undefined"==typeof t.title&&(t.title=t.name),t.is_image){var a=new Date,n=$("<a>",{id:"",href:t.upload_directory_prefs.url+t.file_name+"?v="+a.getTime(),title:t.file_name,text:t.title,rel:"#overlay","class":"less_important_link overlay"});t.link=n.wrap("<div>").parent().html()}else t.link=t.title;$(".mainTable tbody").prepend($.tmpl("filemanager_row",t)),$("td.dataTables_empty").size()&&$("td.dataTables_empty").parent().remove(),1!=t.replace&&$("#file_uploader").dialog("option","position","center"),$(".mainTable").show(),$(".mainTable").table("clear_cache")},trigger:"#action_nav a.upload_file"})},$.ee_filemanager.directory_change=function(){function e(e){void 0===t[e]&&(e=0),jQuery.each(t[e],function(e,t){$("select#cat_id").empty().append(t)})}var t=EE.file.directoryInfo,a=new RegExp("!-!","g");$.each(t,function(e,n){$.each(n,function(n,i){var o=new String;$.each(i,function(e,t){o+='<option value="'+t[0]+'">'+t[1].replace(a,String.fromCharCode(160))+"</option>"}),t[e][n]=o})}),$("#dir_id").change(function(){e(this.value)})},$.ee_filemanager.date_range=function(){function e(){"yyyy-mm-dd"!=$("#custom_date_start").val()&&"yyyy-mm-dd"!=$("#custom_date_end").val()&&(focus_number=$("#date_range").children().length,$("#date_range").append('<option id="custom_date_option">'+$("#custom_date_start").val()+" to "+$("#custom_date_end").val()+"</option>"),document.getElementById("date_range").options[focus_number].selected=!0,$("#custom_date_picker").slideUp("fast"),$("#date_range").change())}$("#custom_date_start_span").datepicker({dateFormat:"yy-mm-dd",prevText:"<<",nextText:">>",onSelect:function(t){$("#custom_date_start").val(t),e()}}),$("#custom_date_end_span").datepicker({dateFormat:"yy-mm-dd",prevText:"<<",nextText:">>",onSelect:function(t){$("#custom_date_end").val(t),e()}}),$("#custom_date_start, #custom_date_end").focus(function(){"yyyy-mm-dd"==$(this).val()&&$(this).val("")}),$("#custom_date_start, #custom_date_end").keypress(function(){$(this).val().length>=9&&e()}),$("#date_range").change(function(){"custom_date"==$("#date_range").val()?($("#custom_date_start").val("yyyy-mm-dd"),$("#custom_date_end").val("yyyy-mm-dd"),$("#custom_date_option").remove(),$("#custom_date_picker").slideDown("fast")):$("#custom_date_picker").hide()})},$.ee_filemanager.toggle_all=function(){$(".toggle_all").toggle(function(){$("input.toggle").each(function(){this.checked=!0})},function(){this.checked;$("input.toggle").each(function(){this.checked=!1})})},$.ee_filemanager.image_overlay=function(){function e(){return $("#overlay").hide().removeData("overlay"),$("#overlay .contentWrap img").remove(),$("<img />").appendTo("#overlay .contentWrap").load(function(){var e=$(this).clone().appendTo(document.body).show(),t=e.width(),a=e.height(),n=.8*$(window).width(),i=.8*$(window).height(),o=n/t,r=i/a,l=o>r?r:o;e.remove(),1>l&&(a*=l,t*=l,$(this).height(a).width(t)),$("#overlay").overlay({load:!0,speed:100,top:"center"})}).attr("src",$(this).attr("href")),!1}$("a.overlay").live("click",e),$("#overlay").css("cursor","pointer").click(function(){$(this).fadeOut(100)})},$.ee_filemanager.datatables=function(){$(".mainTable").table("add_filter",$("#filterform"))};